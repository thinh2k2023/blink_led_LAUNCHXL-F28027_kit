/************************************************************************/
/* PROGRAM      : YZ-028-OBC                                            */
/* FILE         : cpu_timer_driver.c                                    */
/* DESCRIPTION  :                                                       */
/* CPU GROUP    : TMS32F280041                                          */
/* DATE         : 2020/1/15                                             */
/* Copyright    :                                                       */
/************************************************************************/

/***********************************************************************************************************************
Includes
***********************************************************************************************************************/
#include "common.h"
#include "cpu_timer_driver.h"

/***********************************************************************************************************************
Global variable
***********************************************************************************************************************/

/***********************************************************************************************************************
File local variable
***********************************************************************************************************************/

/***********************************************************************************************************************
Prototype declaration (File local function)
***********************************************************************************************************************/
void Timer0Init(Uint32 Fre);

/***********************************************************************************************************************
Function declaration
***********************************************************************************************************************/
void InitTimer(void)
{
   /*
    * AUTHER:
    * UNIT-ID: 0
    * DESCRIPTION: This function initializes controller.
    * ARGUMENT: nothing
    * RETURN: nothing
    * NOTE:
    */

    Timer0Init(10000);   /* 200us_timer(5kHz) or 100us(10kHz) */
}

void Timer0Init(Uint32 Fre)
{
   /*
    * AUTHER:
    * UNIT-ID: 0
    * DESCRIPTION: This function initializes controller.
    * ARGUMENT: nothing
    * RETURN: nothing
    * NOTE:
    */

    Uint32 temp;

    temp = (SYSTEMCLK / Fre) - 1;

//    CpuTimer0Regs.PRD.all = 0xFFFFFFFF;
//    CpuTimer0Regs.TPRH.all = 0x0;
//    CpuTimer0Regs.TPR.all = 0x0;
//    CpuTimer0Regs.TCR.bit.TSS = 1;
//    CpuTimer0Regs.TCR.bit.TRB = 1;

    CpuTimer0Regs.PRD.all = temp;
    CpuTimer0Regs.TCR.bit.TRB = 1;
//    CpuTimer0Regs.TCR.bit.FREE = 0;
//    CpuTimer0Regs.TCR.bit.SOFT = 0;
//    CpuTimer0Regs.TCR.bit.TIE = 0;

//    CpuTimer0Regs.TCR.bit.TRB = 1;
//    CpuTimer0Regs.TCR.bit.TSS = 0;
}
/***********************************************************************************************************************
End of file
***********************************************************************************************************************/
